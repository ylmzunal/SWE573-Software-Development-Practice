<div>
    <h2>{{ post.title }}</h2>
    <p>{{ post.content }}</p>
    {% if post.image %}
    <img src="{{ post.image.url }}" alt="Post Image">
    {% endif %}

    <!-- Yorumları Görüntüleme -->
    <div id="comments-section">
        <h3>Comments</h3>
        {% for comment in comments %}
            <div class="comment">
                <p>{{ comment.content }}</p>
                <small>
                    By {% if comment.user %} {{ comment.user.username }} {% else %} Anonymous {% endif %}
                    | {{ comment.created_at }}
                </small>
            </div>
        {% empty %}
            <p>No comments yet. Be the first to comment!</p>
        {% endfor %}
    </div>

    <!-- Yorum Ekleme Formu -->
    <form method="POST" action="{% url 'add_comment' post.id %}">
        {% csrf_token %}
        <textarea name="content" placeholder="Add your comment here..." required></textarea>
        <button type="submit">Submit</button>
    </form>
</div>

{% comment %} Dinamik Ekran  {% endcomment %}
{% comment %} <div id="post-details">
    <h1>{{ post.title }}</h1>
    <p>{{ post.content }}</p>

    {% if post.image %}
        <img src="{{ post.image.url }}" alt="Post Image">
    {% endif %}

    <hr>

    <h2>Comments</h2>
    <div id="comments-list">
        {% for comment in comments %}
    <div class="comment">
        <p>{{ comment.content }}</p>
        <small>
            By 
            {% if comment.user %}
                {{ comment.user.username }}
            {% else %}
                Anonymous
            {% endif %}
            | {{ comment.created_at }}
        </small>
    </div>
{% endfor %}
    </div>

    <hr>

    <h3>Add a Comment</h3>
    <form id="comment-form">
        {% csrf_token %}
        <textarea name="content" id="comment-content" rows="4" placeholder="Write your comment"></textarea>
        <button type="submit">Submit Comment</button>
    </form>
</div> {% endcomment %}

{% comment %} <script>
    const form = document.getElementById('comment-form');
    const commentsList = document.getElementById('comments-list');

    form.addEventListener('submit', function (e) {
        e.preventDefault();

        const content = document.getElementById('comment-content').value;
        const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;

        fetch("{% url 'add_comment' post.id %}", {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrfToken
            },
            body: JSON.stringify({ content })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                const newComment = document.createElement('div');
                newComment.classList.add('comment');
                newComment.innerHTML = `
                    <p>${data.comment.content}</p>
                    <small>By ${data.comment.username} | ${data.comment.created_at}</small>
                `;
                commentsList.appendChild(newComment);
                form.reset();  // Formu temizle
            } else {
                alert('Failed to add comment');
            }
        })
        .catch(error => {
            console.error('Error:', error);
        });
    });
</script>  {% endcomment %}