{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    {% load static %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Object Finder</title>
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
</head>
<body>
    <header>
        <div class="nav">
            {% if user.is_authenticated %}
            <button id="create-post-btn" class="action-btn">Create New Post</button>
        {% endif %}
            {% if user.is_authenticated %}
                <form method="post" action="{% url 'logout' %}" style="display: inline;">
                    {% csrf_token %}
                    <button type="submit" class="nav-btn">Logout</button>
                </form>
                <a href="{% url 'profile' user.username %}" class="nav-link">{{ user.username }}</a>
            {% else %}
                <a href="{% url 'login' %}" class="nav-link">Login</a>
                <a href="{% url 'register' %}" class="nav-link">Register</a>
            {% endif %}
        </div>
        <!-- Wikidata Search Bar -->
        <form method="get" action="{% url 'wikidata_search' %}">
            <input type="text" name="q" placeholder="Search Wikidata">
            <button type="submit">Search</button>
        </form>
        <div class="brand">
            <h1>Object Finder</h1>
        </div>
    </header>

    <main class="container">
        <aside class="sidebar">
            <h2>Questions</h2>
            <div id="post-list">
                {% for post in posts %}
                    <div class="post" onclick="loadPostDetails({{ post.id }})">
                        <h3>{{ post.title }}</h3>
                        <p>{{ post.content|truncatechars:100 }}</p>
                        {% if post.image %}
                            <img src="{{ post.image.url }}" alt="Post Image" class="post-image">
                        {% endif %}
                        <div class="post-meta">
                            <small>
                                Author: {% if post.author %} {{ post.author.username }} {% else %} Anonymous {% endif %}
                            </small>
                            <small> | {{ post.created_at }} | </small>
                            <small> | Answers: {{ post.comments.count }}</small>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </aside>

        <section class="main-content" id="main-content">
            <h2>Question Details</h2>
            <p>Select a post to see its details and comments.</p>
        </section>
    </main>

    {% if user.is_authenticated %}
        <button id="create-post-btn" class="action-btn">Create New Post</button>
    {% endif %}

    <script>
        document.getElementById('create-post-btn').addEventListener('click', function () {
            fetch('/create-post-form/')
                .then(response => response.text())
                .then(html => {
                    document.getElementById('main-content').innerHTML = html;
                });
        });

        function loadPostDetails(postId) {
            fetch(`/post-details/${postId}/`)
                .then(response => response.text())
                .then(html => {
                    document.getElementById('main-content').innerHTML = html;
                });
        }
    </script>
</body>
</html>